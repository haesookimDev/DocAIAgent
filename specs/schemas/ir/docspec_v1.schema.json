{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://workagent.example.com/schemas/ir/docspec_v1.schema.json",
  "title": "DocSpec v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "doc", "sections"],
  "properties": {
    "schema_version": { "type": "string", "const": "docspec_v1" },

    "doc": {
      "type": "object",
      "additionalProperties": false,
      "required": ["title", "language"],
      "properties": {
        "title": { "type": "string", "minLength": 1, "maxLength": 300 },
        "subtitle": { "type": "string", "maxLength": 500 },
        "language": { "type": "string", "minLength": 2, "maxLength": 20 },
        "audience": { "type": "string", "maxLength": 200 },
        "tone": { "type": "string", "maxLength": 200 },
        "metadata": { "type": "object", "additionalProperties": true }
      }
    },

    "template": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "template_id": { "type": "string", "minLength": 1, "maxLength": 120 },
        "brand_kit_id": { "type": "string", "minLength": 1, "maxLength": 120 }
      }
    },

    "sections": {
      "type": "array",
      "minItems": 1,
      "maxItems": 500,
      "items": { "$ref": "#/$defs/section" }
    },

    "extensions": { "type": "object" }
  },

  "$defs": {
    "id": { "type": "string", "minLength": 1, "maxLength": 120 },

    "citation": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "evidence_id"],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "evidence_id": { "$ref": "#/$defs/id" },
        "title": { "type": "string", "maxLength": 300 },
        "source": { "type": "string", "maxLength": 300 },
        "locator": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "page": { "type": "integer", "minimum": 1 },
            "section": { "type": "string", "maxLength": 200 }
          }
        },
        "quote": { "type": "string", "maxLength": 2000 },
        "url": { "type": "string", "format": "uri" },
        "extensions": { "type": "object" }
      }
    },

    "section": {
      "type": "object",
      "additionalProperties": false,
      "required": ["section_id", "heading", "level", "blocks"],
      "properties": {
        "section_id": { "$ref": "#/$defs/id" },
        "heading": { "type": "string", "minLength": 1, "maxLength": 300 },
        "level": { "type": "integer", "minimum": 1, "maximum": 6 },

        "blocks": {
          "type": "array",
          "minItems": 1,
          "maxItems": 2000,
          "items": { "$ref": "#/$defs/block" }
        },

        "citations": { "type": "array", "maxItems": 200, "items": { "$ref": "#/$defs/citation" } },
        "extensions": { "type": "object" }
      }
    },

    "block": {
      "type": "object",
      "additionalProperties": false,
      "required": ["block_id", "kind", "content"],
      "properties": {
        "block_id": { "$ref": "#/$defs/id" },
        "kind": { "type": "string", "enum": ["paragraph", "bullets", "table", "image", "page_break"] },
        "content": { "type": "object" },
        "citations": { "type": "array", "maxItems": 50, "items": { "$ref": "#/$defs/citation" } },
        "extensions": { "type": "object" }
      },
      "allOf": [
        { "if": { "properties": { "kind": { "const": "paragraph" } } }, "then": { "properties": { "content": { "$ref": "#/$defs/paragraph" } } } },
        { "if": { "properties": { "kind": { "const": "bullets" } } }, "then": { "properties": { "content": { "$ref": "#/$defs/bullets" } } } },
        { "if": { "properties": { "kind": { "const": "table" } } }, "then": { "properties": { "content": { "$ref": "#/$defs/table" } } } },
        { "if": { "properties": { "kind": { "const": "image" } } }, "then": { "properties": { "content": { "$ref": "#/$defs/image" } } } },
        { "if": { "properties": { "kind": { "const": "page_break" } } }, "then": { "properties": { "content": { "$ref": "#/$defs/pageBreak" } } } }
      ]
    },

    "paragraph": {
      "type": "object",
      "additionalProperties": false,
      "required": ["text"],
      "properties": {
        "text": { "type": "string", "minLength": 1, "maxLength": 50000 },
        "format": { "type": "string", "enum": ["plain", "markdown"], "default": "plain" }
      }
    },

    "bullets": {
      "type": "object",
      "additionalProperties": false,
      "required": ["items"],
      "properties": {
        "items": { "type": "array", "minItems": 1, "maxItems": 5000, "items": { "type": "string", "minLength": 1, "maxLength": 2000 } }
      }
    },

    "table": {
      "type": "object",
      "additionalProperties": false,
      "required": ["columns", "rows"],
      "properties": {
        "columns": { "type": "array", "minItems": 1, "maxItems": 50, "items": { "type": "string", "minLength": 1, "maxLength": 200 } },
        "rows": {
          "type": "array",
          "minItems": 1,
          "maxItems": 20000,
          "items": {
            "type": "array",
            "minItems": 1,
            "maxItems": 50,
            "items": { "type": ["string", "number", "null"] }
          }
        }
      }
    },

    "image": {
      "type": "object",
      "additionalProperties": false,
      "oneOf": [{ "required": ["asset_id"] }, { "required": ["url"] }],
      "properties": {
        "asset_id": { "$ref": "#/$defs/id" },
        "url": { "type": "string", "format": "uri" },
        "alt_text": { "type": "string", "maxLength": 500 },
        "caption": { "type": "string", "maxLength": 500 }
      }
    },

    "pageBreak": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "reason": { "type": "string", "maxLength": 200 } }
    }
  }
}
