{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://workagent.example.com/schemas/layout/layout_plan_v1.schema.json",
  "title": "LayoutPlan v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "renderer", "deck", "theme", "slides", "summary"],
  "properties": {
    "schema_version": { "type": "string", "const": "layout_plan_v1" },

    "renderer": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "version"],
      "properties": {
        "name": { "type": "string", "minLength": 1, "maxLength": 120 },
        "version": { "type": "string", "minLength": 1, "maxLength": 50 }
      }
    },

    "deck": {
      "type": "object",
      "additionalProperties": false,
      "required": ["slide_size", "width_in", "height_in", "safe_area_in", "footer_band_in"],
      "properties": {
        "slide_size": { "type": "string", "minLength": 1, "maxLength": 80 },
        "width_in": { "type": "number", "minimum": 1, "maximum": 100 },
        "height_in": { "type": "number", "minimum": 1, "maximum": 100 },
        "safe_area_in": { "$ref": "#/$defs/bboxIn" },
        "footer_band_in": { "$ref": "#/$defs/bboxIn" }
      }
    },

    "theme": {
      "type": "object",
      "additionalProperties": false,
      "required": ["template_id", "brand_kit_id"],
      "properties": {
        "template_id": { "type": "string", "minLength": 1 },
        "brand_kit_id": { "type": "string", "minLength": 1 },
        "fonts": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "heading": { "type": "string" },
            "body": { "type": "string" }
          }
        },
        "min_font_pt": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "heading": { "type": "number", "minimum": 6, "maximum": 72 },
            "body": { "type": "number", "minimum": 6, "maximum": 72 }
          }
        }
      }
    },

    "slides": {
      "type": "array",
      "minItems": 1,
      "maxItems": 500,
      "items": { "$ref": "#/$defs/slidePlan" }
    },

    "summary": {
      "type": "object",
      "additionalProperties": false,
      "required": ["slide_count", "issue_counts", "generated_at"],
      "properties": {
        "slide_count": { "type": "integer", "minimum": 1, "maximum": 500 },
        "issue_counts": {
          "type": "object",
          "additionalProperties": false,
          "required": ["overflow", "overlap", "out_of_bounds", "min_font"],
          "properties": {
            "overflow": { "type": "integer", "minimum": 0 },
            "overlap": { "type": "integer", "minimum": 0 },
            "out_of_bounds": { "type": "integer", "minimum": 0 },
            "min_font": { "type": "integer", "minimum": 0 }
          }
        },
        "generated_at": { "type": "string", "format": "date-time" }
      }
    },

    "extensions": { "type": "object" }
  },

  "$defs": {
    "slidePlan": {
      "type": "object",
      "additionalProperties": false,
      "required": ["slide_id", "layout_id", "elements"],
      "properties": {
        "slide_id": { "type": "string", "minLength": 1, "maxLength": 80 },
        "layout_id": { "type": "string", "minLength": 1, "maxLength": 120 },

        "placeholders": {
          "type": "array",
          "items": { "$ref": "#/$defs/placeholder" },
          "maxItems": 100
        },

        "elements": {
          "type": "array",
          "minItems": 1,
          "maxItems": 200,
          "items": { "$ref": "#/$defs/elementPlan" }
        },

        "diagnostics": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "overlaps": {
              "type": "array",
              "items": { "$ref": "#/$defs/overlap" },
              "maxItems": 500
            },
            "out_of_bounds": {
              "type": "array",
              "items": { "$ref": "#/$defs/outOfBounds" },
              "maxItems": 500
            }
          }
        },

        "extensions": { "type": "object" }
      }
    },

    "placeholder": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "bbox_in"],
      "properties": {
        "name": { "type": "string", "minLength": 1, "maxLength": 80 },
        "bbox_in": { "$ref": "#/$defs/bboxIn" }
      }
    },

    "elementPlan": {
      "type": "object",
      "additionalProperties": false,
      "required": ["element_id", "kind", "layout"],
      "properties": {
        "element_id": { "type": "string", "minLength": 1, "maxLength": 80 },
        "kind": {
          "type": "string",
          "enum": ["text", "bullets", "image", "chart", "table", "shape", "divider"]
        },
        "role": { "type": "string", "maxLength": 80 },

        "source_ref": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "path": { "type": "string", "minLength": 1 }
          }
        },

        "resolved_style": { "$ref": "#/$defs/resolvedStyle" },

        "layout": {
          "type": "object",
          "additionalProperties": false,
          "required": ["bbox_in"],
          "properties": {
            "bbox_in": { "$ref": "#/$defs/bboxIn" },
            "z_index": { "type": "integer", "minimum": 0, "maximum": 10000 },
            "align": { "type": "string", "enum": ["left", "center", "right", "justify"] },
            "valign": { "type": "string", "enum": ["top", "middle", "bottom"] }
          }
        },

        "text_metrics": { "$ref": "#/$defs/textMetrics" },

        "extensions": { "type": "object" }
      }
    },

    "resolvedStyle": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "font_family": { "type": "string", "maxLength": 200 },
        "font_pt": { "type": "number", "minimum": 1, "maximum": 200 },
        "line_height_pt": { "type": "number", "minimum": 1, "maximum": 400 },
        "bold": { "type": "boolean" },
        "italic": { "type": "boolean" },
        "color_hex": { "type": "string", "pattern": "^#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{8})$" }
      }
    },

    "textMetrics": {
      "type": "object",
      "additionalProperties": false,
      "required": ["wrap_mode", "required_height_in", "box_height_in", "overflow"],
      "properties": {
        "text_length": { "type": "integer", "minimum": 0 },
        "wrap_mode": { "type": "string", "enum": ["word", "char", "none"] },
        "lines": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["text", "width_in", "height_in"],
            "properties": {
              "text": { "type": "string" },
              "width_in": { "type": "number", "minimum": 0 },
              "height_in": { "type": "number", "minimum": 0 }
            }
          },
          "maxItems": 500
        },
        "required_height_in": { "type": "number", "minimum": 0 },
        "box_height_in": { "type": "number", "minimum": 0 },
        "overflow": {
          "type": "object",
          "additionalProperties": false,
          "required": ["is_overflow", "ratio"],
          "properties": {
            "is_overflow": { "type": "boolean" },
            "ratio": { "type": "number", "minimum": 0 }
          }
        }
      }
    },

    "overlap": {
      "type": "object",
      "additionalProperties": false,
      "required": ["a", "b", "overlap_ratio"],
      "properties": {
        "a": { "type": "string", "minLength": 1 },
        "b": { "type": "string", "minLength": 1 },
        "overlap_area_in2": { "type": "number", "minimum": 0 },
        "overlap_ratio": { "type": "number", "minimum": 0, "maximum": 1 }
      }
    },

    "outOfBounds": {
      "type": "object",
      "additionalProperties": false,
      "required": ["element_id", "bbox_in"],
      "properties": {
        "element_id": { "type": "string", "minLength": 1 },
        "bbox_in": { "$ref": "#/$defs/bboxIn" },
        "details": { "type": "object" }
      }
    },

    "bboxIn": {
      "type": "object",
      "additionalProperties": false,
      "required": ["x", "y", "w", "h"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "w": { "type": "number", "minimum": 0 },
        "h": { "type": "number", "minimum": 0 }
      }
    }
  }
}
