<!DOCTYPE html>
<html lang="{{ language | default('ko') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ deck_title | default('Presentation') }}</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        accent: {
                            DEFAULT: '#8b5cf6',
                            light: '#a78bfa',
                            dark: '#7c3aed',
                        },
                        slate: {
                            850: '#172033',
                        }
                    },
                    fontFamily: {
                        sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'slide-left': 'slideLeft 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideLeft: {
                            '0%': { opacity: '0', transform: 'translateX(20px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                    },
                }
            }
        }
    </script>
    <style>
        /* Slide container */
        .slide {
            width: 960px;
            height: 540px;
            aspect-ratio: 16 / 9;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Gradient backgrounds */
        .gradient-primary {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        .gradient-accent {
            background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        }
        .gradient-dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        .gradient-light {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        /* Glass effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Chart placeholder gradient */
        .chart-gradient {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
        }

        /* Print styles */
        @media print {
            .slide {
                page-break-after: always;
                margin: 0;
                box-shadow: none;
            }
        }
    </style>
</head>
<body class="bg-slate-100 font-sans antialiased">
{{ content | safe }}

<script>
// Initialize all charts after DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
});

// Also allow manual initialization (for dynamic content)
function initializeCharts() {
    document.querySelectorAll('.chart-container[data-chart]').forEach(function(container) {
        if (container.dataset.initialized === 'true') return;

        const canvas = container.querySelector('canvas');
        if (!canvas) return;

        try {
            const chartData = JSON.parse(container.dataset.chart);
            createChart(canvas, chartData);
            container.dataset.initialized = 'true';
        } catch (e) {
            console.error('Failed to initialize chart:', e);
        }
    });
}

function createChart(canvas, chartData) {
    const chartType = chartData.chart_type;
    const series = chartData.series || [];
    const title = chartData.title || '';

    // Color palette
    const colors = [
        { bg: 'rgba(59, 130, 246, 0.7)', border: 'rgb(59, 130, 246)' },
        { bg: 'rgba(139, 92, 246, 0.7)', border: 'rgb(139, 92, 246)' },
        { bg: 'rgba(16, 185, 129, 0.7)', border: 'rgb(16, 185, 129)' },
        { bg: 'rgba(249, 115, 22, 0.7)', border: 'rgb(249, 115, 22)' },
        { bg: 'rgba(236, 72, 153, 0.7)', border: 'rgb(236, 72, 153)' },
        { bg: 'rgba(99, 102, 241, 0.7)', border: 'rgb(99, 102, 241)' },
    ];

    // Prepare labels and datasets based on chart type
    let labels = [];
    let datasets = [];

    if (chartType === 'pie') {
        // For pie charts, use the first series
        if (series.length > 0) {
            labels = series[0].data.map(d => String(d.x));
            datasets = [{
                data: series[0].data.map(d => d.y),
                backgroundColor: series[0].data.map((_, i) => colors[i % colors.length].bg),
                borderColor: series[0].data.map((_, i) => colors[i % colors.length].border),
                borderWidth: 2,
            }];
        }
    } else {
        // For bar, line, area charts
        // Extract labels from first series
        if (series.length > 0) {
            labels = series[0].data.map(d => String(d.x));
        }

        datasets = series.map((s, idx) => ({
            label: s.name,
            data: s.data.map(d => d.y),
            backgroundColor: colors[idx % colors.length].bg,
            borderColor: colors[idx % colors.length].border,
            borderWidth: 2,
            fill: chartType === 'area',
            tension: chartType === 'line' || chartType === 'area' ? 0.3 : 0,
        }));
    }

    // Map chart types
    let type = chartType;
    if (type === 'area') type = 'line';
    if (type === 'stacked_bar') type = 'bar';

    const config = {
        type: type,
        data: {
            labels: labels,
            datasets: datasets,
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: series.length > 1 || chartType === 'pie',
                    position: chartType === 'pie' ? 'right' : 'top',
                    labels: {
                        font: { size: 11 },
                        padding: 12,
                    },
                },
                title: {
                    display: !!title,
                    text: title,
                    font: { size: 14, weight: 'bold' },
                    padding: { bottom: 16 },
                },
            },
            scales: chartType === 'pie' ? {} : {
                x: {
                    title: {
                        display: !!chartData.x_label,
                        text: chartData.x_label || '',
                        font: { size: 11 },
                    },
                    grid: { display: false },
                    stacked: chartType === 'stacked_bar',
                },
                y: {
                    title: {
                        display: !!chartData.y_label,
                        text: chartData.y_label || '',
                        font: { size: 11 },
                    },
                    beginAtZero: true,
                    stacked: chartType === 'stacked_bar',
                },
            },
        },
    };

    new Chart(canvas, config);
}

// Expose for external use
window.initializeCharts = initializeCharts;
</script>
</body>
</html>
