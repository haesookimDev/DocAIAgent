{# Timeline Layout - 타임라인/프로세스 슬라이드 (Tailwind) #}
{# 기본 배경: bg-white (밝은 배경) #}
{% set bg_class = style_classes | default('bg-white scheme-default text-theme-dark') %}
{% set dark_bg = is_dark_bg | default(false) %}
<div class="slide {{ bg_class }} relative overflow-hidden my-5 mx-auto rounded-2xl shadow-2xl {{ slide_tailwind_classes }}"
     data-slide-id="{{ slide_id }}" data-layout="timeline">

    <!-- Top accent bar -->
    <div class="absolute top-0 left-0 right-0 h-1 gradient-primary"></div>

    <!-- Content -->
    <div class="h-full flex flex-col" style="padding: 5% 6%;">
        <!-- Header -->
        <div style="flex: 0 0 auto; margin-bottom: 4%;">
            {% set ns = namespace(found=false) %}
            {% for element in elements %}
                {% if element.role == 'title' and not ns.found %}
                    <h2 class="text-4xl font-bold {{ 'text-white' if dark_bg else 'text-slate-800' }} animate-slide-up flex items-center gap-4 {{ element.tailwind_classes }}">
                        <span class="w-2 h-10 bg-gradient-to-b from-primary-500 to-accent rounded-full"></span>
                        {{ element.content.text }}
                    </h2>
                    {% set ns.found = true %}
                {% endif %}
            {% endfor %}
        </div>

        <!-- Timeline Body -->
        <div class="flex-1 relative overflow-auto" style="min-height: 0;">
            {# Horizontal timeline line #}
            <div class="absolute top-1/2 left-0 right-0 h-1 {{ 'bg-white/20' if dark_bg else 'bg-gradient-to-r from-primary-200 via-accent/50 to-primary-200' }} -translate-y-1/2"></div>

            <div class="h-full flex items-center justify-around gap-4 relative">
                {% set timeline_colors = ['bg-primary-500', 'bg-accent', 'bg-emerald-500', 'bg-orange-500', 'bg-pink-500'] %}
                {% set step_ns = namespace(count=0) %}

                {% for element in elements if element.role != 'title' %}
                    {% if element.kind == 'bullets' %}
                        {% for item in element.content['items'] %}
                            {% set step_ns.count = step_ns.count + 1 %}
                            {% set color_idx = (step_ns.count - 1) % 5 %}
                            {% set item_text = item if item is string else item.text %}
                            {% set item_parts = item_text.split('\n') if '\n' in item_text else item_text.split(':') if ':' in item_text else [item_text] %}

                            <div class="flex flex-col items-center animate-fade-in relative" style="animation-delay: {{ (step_ns.count - 1) * 150 }}ms; width: {{ 90 / (element.content['items'] | length) }}%;">
                                {# Step number circle #}
                                <div class="{{ timeline_colors[color_idx] }} w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg z-10">
                                    {{ step_ns.count }}
                                </div>

                                {# Content card #}
                                <div class="{{ 'bg-white/10' if dark_bg else 'bg-white shadow-md' }} rounded-xl p-4 mt-4 w-full text-center">
                                    <p class="font-semibold text-lg {{ 'text-white' if dark_bg else 'text-slate-800' }} mb-1">
                                        {{ item_parts[0] | trim }}
                                    </p>
                                    {% if item_parts | length > 1 %}
                                        <p class="text-sm {{ 'text-white/70' if dark_bg else 'text-slate-500' }}">
                                            {{ item_parts[1] | trim }}
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% elif element.kind == 'text' and element.role != 'title' %}
                        {% set step_ns.count = step_ns.count + 1 %}
                        {% set color_idx = (step_ns.count - 1) % 5 %}
                        {% set text_parts = element.content.text.split('\n') if '\n' in element.content.text else [element.content.text] %}

                        <div class="flex flex-col items-center animate-fade-in relative" style="animation-delay: {{ (step_ns.count - 1) * 150 }}ms;">
                            <div class="{{ timeline_colors[color_idx] }} w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg z-10">
                                {{ step_ns.count }}
                            </div>
                            <div class="{{ 'bg-white/10' if dark_bg else 'bg-white shadow-md' }} rounded-xl p-4 mt-4 text-center">
                                <p class="font-semibold text-lg {{ 'text-white' if dark_bg else 'text-slate-800' }}">
                                    {{ text_parts[0] }}
                                </p>
                                {% if text_parts | length > 1 %}
                                    <p class="text-sm {{ 'text-white/70' if dark_bg else 'text-slate-500' }} mt-1">{{ text_parts[1] }}</p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="absolute bottom-0 left-0 right-0 flex justify-between items-center text-sm {{ 'border-t border-white/10' if dark_bg else 'border-t border-slate-100' }}" style="padding: 1.5% 4%;">
        {% if citations %}
        <span class="{{ 'text-white/50' if dark_bg else 'text-slate-400' }} flex gap-1">
            {% for citation in citations %}<span class="{{ 'text-white/70' if dark_bg else 'text-primary-500' }}">[{{ loop.index }}]</span>{% endfor %}
        </span>
        {% else %}<span></span>{% endif %}
        <span class="{{ 'bg-white/10 text-white/70' if dark_bg else 'bg-slate-100 text-slate-500' }} px-2.5 py-0.5 rounded-full font-medium">{{ slide_index + 1 }}</span>
    </div>
</div>
